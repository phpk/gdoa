
const openFunc = function (editor, url) {
    let pluginName = '打开文件（*）';

    let openData = function () {
        //定义一个配置项
        let opt = {};
        opt.action = "word/openFile"; //必填，上传接口地址
        //opt.filter = ""; //可选，文件过滤
        opt.maxsize = 500; //可选，文件大小限制，单位M
        //开始上传的钩子函数
        let layindex = layer.load(2);
        opt.startCallback = (file) => {
            console.log("文件开始上传", file); //file是已经开始上传的本地文件对象
        }
        //上传进度的钩子函数
        opt.progressCallback = (object) => {
            if (object.computable) {
                console.log(
                    "上传中...",
                    "当前速度：" + object.speed,
                    "已上传 " + Math.round(object.progress * 100) + "%"
                )
            }
        }

        //上传成功的钩子函数
        opt.successCallback = (res) => {
            console.log("上传成功", res); //data是接口返回的数据
            layer.close(layindex);
            if (res.code == 0) {
                editor.setContent(res.data)
            } else {
                layer.msg(res.message, {icon :2})
            }
        }
        opt.errorCallback = (msg) => {
            layer.close(layindex);
            layer.msg(msg, { icon: 2 })
        }
        //设置上传配置项
        easyuploader.setOption(opt);

        easyuploader.upload();
    };
    
    let svgStr = `<svg t="1640494215625" class="icon" viewBox="0 0 1048 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1287" width="20" height="20"><path d="M387.121951 636.878049m-387.121951 0a387.121951 387.121951 0 1 0 774.243902 0 387.121951 387.121951 0 1 0-774.243902 0Z" fill="#FFEFDB" p-id="1288"></path><path d="M899.121951 574.439024v224.780488H249.756098V274.731707h212.292682l87.414635 69.931708V0h499.512195v574.439024H899.121951zM437.073171 324.682927H299.707317v424.585366h549.463415V424.585366H561.95122zM999.02439 49.95122H599.414634v324.682926h299.707317v149.853659h99.902439V49.95122z" fill="#040405" p-id="1289"></path><path d="M674.341463 299.707317v-49.951219h249.756098v49.951219H674.341463z m0-149.853658h249.756098v49.951219H674.341463v-49.951219z" fill="#FF9E1F" p-id="1290"></path></svg>`;

    editor.ui.registry.getAll().icons.openAll || editor.ui.registry.addIcon('openAll', svgStr);

    editor.ui.registry.addMenuItem('openAll', {
        icon: 'openAll',
        text: pluginName,
        onAction: () => {
            openData()
        }
    });
    return {
        getMetadata: function () {
            return {
                name: pluginName,
                url: "https://godo.im",
            };
        }
    };
}
tinymce.PluginManager.add('openAll', openFunc);
