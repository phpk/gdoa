<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>注册</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="/member/ui/ui/css/ui.css" />

	</head>
	<body>
		<form class="layui-form" action="" lay-filter="editform">
			<div class="mainBox">
				<div class="main-container">
					<div class="main-container">
						<div class="layui-form-item">
							<label class="layui-form-label">用户名</label>
							<div class="layui-input-block">
								<input type="text" name="username" lay-verify="required" autocomplete="off"
									placeholder="请输入用户名" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">邮箱</label>
							<div class="layui-input-block">
								<input type="text" name="email" id="email" lay-verify="required" autocomplete="off"
									placeholder="请输入邮箱" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">邮箱验证码</label>
							<div class="layui-input-inline">
								<input type="text" name="code" id="code" lay-verify="required|code" autocomplete="off"
									placeholder="请输入邮箱验证码" class="layui-input">
							</div>
							<div class="layui-input-inline">
								<button type="button" class="layui-btn" id="send_code" style="width:100px">发送</button>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">密码</label>
							<div class="layui-input-block">
								<input type="password" name="password" lay-verify="required|pass" autocomplete="off"
									placeholder="请输入登录密码" min="6" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">重复密码</label>
							<div class="layui-input-block">
								<input type="password" name="repassword" lay-verify="required|pass" autocomplete="off"
									placeholder="请输入重复密码" min="6" class="layui-input">
							</div>
						</div>

					</div>
				</div>
			</div>
			<div class="bottom">
				<div class="button-container">
					<button type="submit" class="pear-btn pear-btn-primary pear-btn-sm" lay-submit=""
						lay-filter="user-save">
						<i class="layui-icon layui-icon-ok"></i>
						注册
					</button>
				</div>
			</div>
		</form>
		<script src="/member/ui/config.js"></script>
		<script src="/member/ui/layui/layui.js"></script>
		<script src="/member/ui/ui/ui.js"></script>
		<script>
			layui.use([
				'form', 'layer'
			], function() {
				let form = layui.form,
					layer = layui.layer,
					$ = layui.$;
				const emailExp = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                form.verify({
                    pass: [
                        /^[\S]{6,20}$/
                        ,'密码必须6到20位，且不能出现空格'
                    ],
                    code : (v) => {
                        if(v.length != 4) {
                            return '请输入正确的验证码'
                        }
                    },
                    email : (v) => {
                        if (!emailExp.test(v)) {
                            return '请输入正确的邮箱格式'
                        }
                    }

                })
				//监听提交
				form.on('submit(user-save)', function(data) {
					data = data.field;
					_post(layui, 'login/reg', data, res => {
						//console.log(res)
						parent
							.layer
							.close(parent.layer.getFrameIndex(window.name)); //关闭当前页

					})

					return false;
				});
				$('#send_code').on('click', () => {
					let emailVal = $('#email').val();
					//console.log(emailVal)
					//console.log(emailExp.test(emailVal))
					if (!emailExp.test(emailVal)) {
						layer.msg('请输入正确的邮箱格式', {
							icon: 2
						});
						$('#email').focus();
						return false;
					}
					__post('login/sendEmail', {
						email: emailVal
					}, res => {
						if (res.code == 0) {
							let times = 60;
							$('#send_code').attr('disabled', true);
							let setTime = setInterval(() => {
								if (times <= 0) {
									$("#send_code").text("重新发送");
									$('#send_code').attr('disabled', false);
									clearInterval(setTime);
									times = 60;
									return;
								}
								times--;
								$("#send_code").text(times);
							}, 1000);
						}
					})

				});

			});
		</script>

	</body>
</html>
