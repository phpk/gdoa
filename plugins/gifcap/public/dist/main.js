(()=>{var hr=Object.create;var Et=Object.defineProperty,mr=Object.defineProperties,dr=Object.getOwnPropertyDescriptor,gr=Object.getOwnPropertyDescriptors,yr=Object.getOwnPropertyNames,he=Object.getOwnPropertySymbols,wr=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty,br=Object.prototype.propertyIsEnumerable;var de=(n,r,a)=>r in n?Et(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a,J=(n,r)=>{for(var a in r||(r={}))me.call(r,a)&&de(n,a,r[a]);if(he)for(var a of he(r))br.call(r,a)&&de(n,a,r[a]);return n},ut=(n,r)=>mr(n,gr(r)),vr=n=>Et(n,"__esModule",{value:!0});var O=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var xr=(n,r,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of yr(r))!me.call(n,s)&&s!=="default"&&Et(n,s,{get:()=>r[s],enumerable:!(a=dr(r,s))||a.enumerable});return n},rt=n=>xr(vr(Et(n!=null?hr(wr(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var it=O((Qr,ge)=>{"use strict";function ct(n,r,a,s,h,l){return{tag:n,key:r,attrs:a,children:s,text:h,dom:l,domSize:void 0,state:void 0,events:void 0,instance:void 0}}ct.normalize=function(n){return Array.isArray(n)?ct("[",void 0,void 0,ct.normalizeChildren(n),void 0,void 0):n==null||typeof n=="boolean"?null:typeof n=="object"?n:ct("#",void 0,void 0,String(n),void 0,void 0)};ct.normalizeChildren=function(n){var r=[];if(n.length){for(var a=n[0]!=null&&n[0].key!=null,s=1;s<n.length;s++)if((n[s]!=null&&n[s].key!=null)!==a)throw new TypeError("Vnodes must either always have keys or never have keys!");for(var s=0;s<n.length;s++)r[s]=ct.normalize(n[s])}return r};ge.exports=ct});var Qt=O((Yr,ye)=>{"use strict";var Mr=it();ye.exports=function(){var n=arguments[this],r=this+1,a;if(n==null?n={}:(typeof n!="object"||n.tag!=null||Array.isArray(n))&&(n={},r=this),arguments.length===r+1)a=arguments[r],Array.isArray(a)||(a=[a]);else for(a=[];r<arguments.length;)a.push(arguments[r++]);return Mr("",n.key,n,a)}});var Yt=O((Jr,xe)=>{"use strict";var we=it(),Er=Qt(),Cr=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,be={},pt={}.hasOwnProperty;function ve(n){for(var r in n)if(pt.call(n,r))return!1;return!0}function Ar(n){for(var r,a="div",s=[],h={};r=Cr.exec(n);){var l=r[1],p=r[2];if(l===""&&p!=="")a=p;else if(l==="#")h.id=p;else if(l===".")s.push(p);else if(r[3][0]==="["){var u=r[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?s.push(u):h[r[4]]=u===""?u:u||!0}}return s.length>0&&(h.className=s.join(" ")),be[n]={tag:a,attrs:h}}function Tr(n,r){var a=r.attrs,s=we.normalizeChildren(r.children),h=pt.call(a,"class"),l=h?a.class:a.className;if(r.tag=n.tag,r.attrs=null,r.children=void 0,!ve(n.attrs)&&!ve(a)){var p={};for(var u in a)pt.call(a,u)&&(p[u]=a[u]);a=p}for(var u in n.attrs)pt.call(n.attrs,u)&&u!=="className"&&!pt.call(a,u)&&(a[u]=n.attrs[u]);(l!=null||n.attrs.className!=null)&&(a.className=l!=null?n.attrs.className!=null?String(n.attrs.className)+" "+String(l):l:n.attrs.className!=null?n.attrs.className:null),h&&(a.class=null);for(var u in a)if(pt.call(a,u)&&u!=="key"){r.attrs=a;break}return Array.isArray(s)&&s.length===1&&s[0]!=null&&s[0].tag==="#"?r.text=s[0].children:r.children=s,r}function Pr(n){if(n==null||typeof n!="string"&&typeof n!="function"&&typeof n.view!="function")throw Error("The selector must be either a string or a component.");var r=Er.apply(1,arguments);return typeof n=="string"&&(r.children=we.normalizeChildren(r.children),n!=="[")?Tr(be[n]||Ar(n),r):(r.tag=n,r)}xe.exports=Pr});var Ee=O((Zr,Me)=>{"use strict";var Rr=it();Me.exports=function(n){return n==null&&(n=""),Rr("<",void 0,void 0,n,void 0,void 0)}});var Ae=O((ti,Ce)=>{"use strict";var qr=it(),Or=Qt();Ce.exports=function(){var n=Or.apply(0,arguments);return n.tag="[",n.children=qr.normalizeChildren(n.children),n}});var Pe=O((ei,Te)=>{"use strict";var Jt=Yt();Jt.trust=Ee();Jt.fragment=Ae();Te.exports=Jt});var Zt=O((ri,Re)=>{"use strict";var k=function(n){if(!(this instanceof k))throw new Error("Promise must be called with `new`");if(typeof n!="function")throw new TypeError("executor must be a function");var r=this,a=[],s=[],h=f(a,!0),l=f(s,!1),p=r._instance={resolvers:a,rejectors:s},u=typeof setImmediate=="function"?setImmediate:setTimeout;function f(w,b){return function v(g){var x;try{if(b&&g!=null&&(typeof g=="object"||typeof g=="function")&&typeof(x=g.then)=="function"){if(g===r)throw new TypeError("Promise can't be resolved w/ itself");d(x.bind(g))}else u(function(){!b&&w.length===0&&console.error("Possible unhandled promise rejection:",g);for(var y=0;y<w.length;y++)w[y](g);a.length=0,s.length=0,p.state=b,p.retry=function(){v(g)}})}catch(y){l(y)}}}function d(w){var b=0;function v(x){return function(y){b++>0||x(y)}}var g=v(l);try{w(v(h),g)}catch(x){g(x)}}d(n)};k.prototype.then=function(n,r){var a=this,s=a._instance;function h(f,d,w,b){d.push(function(v){if(typeof f!="function")w(v);else try{l(f(v))}catch(g){p&&p(g)}}),typeof s.retry=="function"&&b===s.state&&s.retry()}var l,p,u=new k(function(f,d){l=f,p=d});return h(n,s.resolvers,l,!0),h(r,s.rejectors,p,!1),u};k.prototype.catch=function(n){return this.then(null,n)};k.prototype.finally=function(n){return this.then(function(r){return k.resolve(n()).then(function(){return r})},function(r){return k.resolve(n()).then(function(){return k.reject(r)})})};k.resolve=function(n){return n instanceof k?n:new k(function(r){r(n)})};k.reject=function(n){return new k(function(r,a){a(n)})};k.all=function(n){return new k(function(r,a){var s=n.length,h=0,l=[];if(n.length===0)r([]);else for(var p=0;p<n.length;p++)(function(u){function f(d){h++,l[u]=d,h===s&&r(l)}n[u]!=null&&(typeof n[u]=="object"||typeof n[u]=="function")&&typeof n[u].then=="function"?n[u].then(f,a):f(n[u])})(p)})};k.race=function(n){return new k(function(r,a){for(var s=0;s<n.length;s++)n[s].then(r,a)})};Re.exports=k});var te=O((ii,Ct)=>{"use strict";var yt=Zt();typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=yt:window.Promise.prototype.finally||(window.Promise.prototype.finally=yt.prototype.finally),Ct.exports=window.Promise):typeof global!="undefined"?(typeof global.Promise=="undefined"?global.Promise=yt:global.Promise.prototype.finally||(global.Promise.prototype.finally=yt.prototype.finally),Ct.exports=global.Promise):Ct.exports=yt});var Oe=O((ni,qe)=>{"use strict";var ht=it();qe.exports=function(n){var r=n&&n.document,a,s={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function h(e){return e.attrs&&e.attrs.xmlns||s[e.tag]}function l(e,t){if(e.state!==t)throw new Error("`vnode.state` must not be modified")}function p(e){var t=e.state;try{return this.apply(t,arguments)}finally{l(e,t)}}function u(){try{return r.activeElement}catch(e){return null}}function f(e,t,i,o,c,m,C){for(var A=i;A<o;A++){var M=t[A];M!=null&&d(e,M,c,C,m)}}function d(e,t,i,o,c){var m=t.tag;if(typeof m=="string")switch(t.state={},t.attrs!=null&&Ft(t.attrs,t,i),m){case"#":w(e,t,c);break;case"<":v(e,t,o,c);break;case"[":g(e,t,i,o,c);break;default:x(e,t,i,o,c)}else E(e,t,i,o,c)}function w(e,t,i){t.dom=r.createTextNode(t.children),st(e,t.dom,i)}var b={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function v(e,t,i,o){var c=t.children.match(/^\s*?<(\w+)/im)||[],m=r.createElement(b[c[1]]||"div");i==="http://www.w3.org/2000/svg"?(m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",m=m.firstChild):m.innerHTML=t.children,t.dom=m.firstChild,t.domSize=m.childNodes.length,t.instance=[];for(var C=r.createDocumentFragment(),A;A=m.firstChild;)t.instance.push(A),C.appendChild(A);st(e,C,o)}function g(e,t,i,o,c){var m=r.createDocumentFragment();if(t.children!=null){var C=t.children;f(m,C,0,C.length,i,null,o)}t.dom=m.firstChild,t.domSize=m.childNodes.length,st(e,m,c)}function x(e,t,i,o,c){var m=t.tag,C=t.attrs,A=C&&C.is;o=h(t)||o;var M=o?A?r.createElementNS(o,m,{is:A}):r.createElementNS(o,m):A?r.createElement(m,{is:A}):r.createElement(m);if(t.dom=M,C!=null&&nr(t,C,o),st(e,M,c),!ot(t)&&(t.text!=null&&(t.text!==""?M.textContent=t.text:t.children=[ht("#",void 0,void 0,t.text,void 0,void 0)]),t.children!=null)){var P=t.children;f(M,P,0,P.length,i,null,o),t.tag==="select"&&C!=null&&sr(t,C)}}function y(e,t){var i;if(typeof e.tag.view=="function"){if(e.state=Object.create(e.tag),i=e.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(e.state=void 0,i=e.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,e.state=e.tag.prototype!=null&&typeof e.tag.prototype.view=="function"?new e.tag(e):e.tag(e)}if(Ft(e.state,e,t),e.attrs!=null&&Ft(e.attrs,e,t),e.instance=ht.normalize(p.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function E(e,t,i,o,c){y(t,i),t.instance!=null?(d(e,t.instance,i,o,c),t.dom=t.instance.dom,t.domSize=t.dom!=null?t.instance.domSize:0):t.domSize=0}function T(e,t,i,o,c,m){if(!(t===i||t==null&&i==null))if(t==null||t.length===0)f(e,i,0,i.length,o,c,m);else if(i==null||i.length===0)W(e,t,0,t.length);else{var C=t[0]!=null&&t[0].key!=null,A=i[0]!=null&&i[0].key!=null,M=0,P=0;if(!C)for(;P<t.length&&t[P]==null;)P++;if(!A)for(;M<i.length&&i[M]==null;)M++;if(A===null&&C==null)return;if(C!==A)W(e,t,P,t.length),f(e,i,M,i.length,o,c,m);else if(A){for(var F=t.length-1,$=i.length-1,Mt,H,V,j,q,Ut;F>=P&&$>=M&&(j=t[F],q=i[$],j.key===q.key);)j!==q&&D(e,j,q,o,c,m),q.dom!=null&&(c=q.dom),F--,$--;for(;F>=P&&$>=M&&(H=t[P],V=i[M],H.key===V.key);)P++,M++,H!==V&&D(e,H,V,o,X(t,P,c),m);for(;F>=P&&$>=M&&!(M===$||H.key!==q.key||j.key!==V.key);)Ut=X(t,P,c),G(e,j,Ut),j!==V&&D(e,j,V,o,Ut,m),++M<=--$&&G(e,H,c),H!==q&&D(e,H,q,o,c,m),q.dom!=null&&(c=q.dom),P++,F--,j=t[F],q=i[$],H=t[P],V=i[M];for(;F>=P&&$>=M&&j.key===q.key;)j!==q&&D(e,j,q,o,c,m),q.dom!=null&&(c=q.dom),F--,$--,j=t[F],q=i[$];if(M>$)W(e,t,P,F+1);else if(P>F)f(e,i,M,$+1,o,c,m);else{var pr=c,pe=$-M+1,gt=new Array(pe),Gt=0,L=0,Kt=2147483647,Xt=0,Mt,Wt;for(L=0;L<pe;L++)gt[L]=-1;for(L=$;L>=M;L--){Mt==null&&(Mt=Y(t,P,F+1)),q=i[L];var ft=Mt[q.key];ft!=null&&(Kt=ft<Kt?ft:-1,gt[L-M]=ft,j=t[ft],t[ft]=null,j!==q&&D(e,j,q,o,c,m),q.dom!=null&&(c=q.dom),Xt++)}if(c=pr,Xt!==F-P+1&&W(e,t,P,F+1),Xt===0)f(e,i,M,$+1,o,c,m);else if(Kt===-1)for(Wt=at(gt),Gt=Wt.length-1,L=$;L>=M;L--)V=i[L],gt[L-M]===-1?d(e,V,o,m,c):Wt[Gt]===L-M?Gt--:G(e,V,c),V.dom!=null&&(c=i[L].dom);else for(L=$;L>=M;L--)V=i[L],gt[L-M]===-1&&d(e,V,o,m,c),V.dom!=null&&(c=i[L].dom)}}else{var Bt=t.length<i.length?t.length:i.length;for(M=M<P?M:P;M<Bt;M++)H=t[M],V=i[M],!(H===V||H==null&&V==null)&&(H==null?d(e,V,o,m,X(t,M+1,c)):V==null?vt(e,H):D(e,H,V,o,X(t,M+1,c),m));t.length>Bt&&W(e,t,M,t.length),i.length>Bt&&f(e,i,M,i.length,o,c,m)}}}function D(e,t,i,o,c,m){var C=t.tag,A=i.tag;if(C===A){if(i.state=t.state,i.events=t.events,ur(i,t))return;if(typeof C=="string")switch(i.attrs!=null&&Ht(i.attrs,i,o),C){case"#":tt(t,i);break;case"<":et(e,t,i,m,c);break;case"[":N(e,t,i,o,c,m);break;default:R(t,i,o,m)}else I(e,t,i,o,c,m)}else vt(e,t),d(e,i,o,m,c)}function tt(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function et(e,t,i,o,c){t.children!==i.children?(ce(e,t),v(e,i,o,c)):(i.dom=t.dom,i.domSize=t.domSize,i.instance=t.instance)}function N(e,t,i,o,c,m){T(e,t.children,i.children,o,c,m);var C=0,A=i.children;if(i.dom=null,A!=null){for(var M=0;M<A.length;M++){var P=A[M];P!=null&&P.dom!=null&&(i.dom==null&&(i.dom=P.dom),C+=P.domSize||1)}C!==1&&(i.domSize=C)}}function R(e,t,i,o){var c=t.dom=e.dom;o=h(t)||o,t.tag==="textarea"&&(t.attrs==null&&(t.attrs={}),t.text!=null&&(t.attrs.value=t.text,t.text=void 0)),or(t,e.attrs,t.attrs,o),ot(t)||(e.text!=null&&t.text!=null&&t.text!==""?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(e.text!=null&&(e.children=[ht("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),t.text!=null&&(t.children=[ht("#",void 0,void 0,t.text,void 0,void 0)]),T(c,e.children,t.children,i,null,o)))}function I(e,t,i,o,c,m){if(i.instance=ht.normalize(p.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");Ht(i.state,i,o),i.attrs!=null&&Ht(i.attrs,i,o),i.instance!=null?(t.instance==null?d(e,i.instance,o,m,c):D(e,t.instance,i.instance,o,c,m),i.dom=i.instance.dom,i.domSize=i.instance.domSize):t.instance!=null?(vt(e,t.instance),i.dom=void 0,i.domSize=0):(i.dom=t.dom,i.domSize=t.domSize)}function Y(e,t,i){for(var o=Object.create(null);t<i;t++){var c=e[t];if(c!=null){var m=c.key;m!=null&&(o[m]=t)}}return o}var B=[];function at(e){for(var t=[0],i=0,o=0,c=0,m=B.length=e.length,c=0;c<m;c++)B[c]=e[c];for(var c=0;c<m;++c)if(e[c]!==-1){var C=t[t.length-1];if(e[C]<e[c]){B[c]=C,t.push(c);continue}for(i=0,o=t.length-1;i<o;){var A=(i>>>1)+(o>>>1)+(i&o&1);e[t[A]]<e[c]?i=A+1:o=A}e[c]<e[t[i]]&&(i>0&&(B[c]=t[i-1]),t[i]=c)}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=B[o];return B.length=0,t}function X(e,t,i){for(;t<e.length;t++)if(e[t]!=null&&e[t].dom!=null)return e[t].dom;return i}function G(e,t,i){var o=r.createDocumentFragment();bt(e,o,t),st(e,o,i)}function bt(e,t,i){for(;i.dom!=null&&i.dom.parentNode===e;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var o=0;o<i.instance.length;o++)t.appendChild(i.instance[o]);else if(i.tag!=="[")t.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var o=0;o<i.children.length;o++){var c=i.children[o];c!=null&&bt(e,t,c)}break}}function st(e,t,i){i!=null?e.insertBefore(t,i):e.appendChild(t)}function ot(e){if(e.attrs==null||e.attrs.contenteditable==null&&e.attrs.contentEditable==null)return!1;var t=e.children;if(t!=null&&t.length===1&&t[0].tag==="<"){var i=t[0].children;e.dom.innerHTML!==i&&(e.dom.innerHTML=i)}else if(e.text!=null||t!=null&&t.length!==0)throw new Error("Child node of a contenteditable must be trusted");return!0}function W(e,t,i,o){for(var c=i;c<o;c++){var m=t[c];m!=null&&vt(e,m)}}function vt(e,t){var i=0,o=t.state,c,m;if(typeof t.tag!="string"&&typeof t.state.onbeforeremove=="function"){var C=p.call(t.state.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i=1,c=C)}if(t.attrs&&typeof t.attrs.onbeforeremove=="function"){var C=p.call(t.attrs.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i|=2,m=C)}if(l(t,o),!i)xt(t),kt(e,t);else{if(c!=null){var A=function(){i&1&&(i&=2,i||M())};c.then(A,A)}if(m!=null){var A=function(){i&2&&(i&=1,i||M())};m.then(A,A)}}function M(){l(t,o),xt(t),kt(e,t)}}function ce(e,t){for(var i=0;i<t.instance.length;i++)e.removeChild(t.instance[i])}function kt(e,t){for(;t.dom!=null&&t.dom.parentNode===e;){if(typeof t.tag!="string"){if(t=t.instance,t!=null)continue}else if(t.tag==="<")ce(e,t);else{if(t.tag!=="["&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(t.children.length===1){if(t=t.children[0],t!=null)continue}else for(var i=0;i<t.children.length;i++){var o=t.children[i];o!=null&&kt(e,o)}}break}}function xt(e){if(typeof e.tag!="string"&&typeof e.state.onremove=="function"&&p.call(e.state.onremove,e),e.attrs&&typeof e.attrs.onremove=="function"&&p.call(e.attrs.onremove,e),typeof e.tag!="string")e.instance!=null&&xt(e.instance);else{var t=e.children;if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o!=null&&xt(o)}}}function nr(e,t,i){for(var o in t)It(e,o,null,t[o],i)}function It(e,t,i,o,c){if(!(t==="key"||t==="is"||o==null||jt(t)||i===o&&!cr(e,t)&&typeof o!="object")){if(t[0]==="o"&&t[1]==="n")return ue(e,t,o);if(t.slice(0,6)==="xlink:")e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),o);else if(t==="style")fe(e.dom,i,o);else if(le(e,t,c)){if(t==="value"&&((e.tag==="input"||e.tag==="textarea")&&e.dom.value===""+o&&e.dom===u()||e.tag==="select"&&i!==null&&e.dom.value===""+o||e.tag==="option"&&i!==null&&e.dom.value===""+o))return;e.tag==="input"&&t==="type"?e.dom.setAttribute(t,o):e.dom[t]=o}else typeof o=="boolean"?o?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute(t==="className"?"class":t,o)}}function ar(e,t,i,o){if(!(t==="key"||t==="is"||i==null||jt(t)))if(t[0]==="o"&&t[1]==="n"&&!jt(t))ue(e,t,void 0);else if(t==="style")fe(e.dom,i,null);else if(le(e,t,o)&&t!=="className"&&!(t==="value"&&(e.tag==="option"||e.tag==="select"&&e.dom.selectedIndex===-1&&e.dom===u()))&&!(e.tag==="input"&&t==="type"))e.dom[t]=null;else{var c=t.indexOf(":");c!==-1&&(t=t.slice(c+1)),i!==!1&&e.dom.removeAttribute(t==="className"?"class":t)}}function sr(e,t){if("value"in t)if(t.value===null)e.dom.selectedIndex!==-1&&(e.dom.value=null);else{var i=""+t.value;(e.dom.value!==i||e.dom.selectedIndex===-1)&&(e.dom.value=i)}"selectedIndex"in t&&It(e,"selectedIndex",null,t.selectedIndex,void 0)}function or(e,t,i,o){if(i!=null)for(var c in i)It(e,c,t&&t[c],i[c],o);var m;if(t!=null)for(var c in t)(m=t[c])!=null&&(i==null||i[c]==null)&&ar(e,c,m,o)}function cr(e,t){return t==="value"||t==="checked"||t==="selectedIndex"||t==="selected"&&e.dom===u()||e.tag==="option"&&e.dom.parentNode===r.activeElement}function jt(e){return e==="oninit"||e==="oncreate"||e==="onupdate"||e==="onremove"||e==="onbeforeremove"||e==="onbeforeupdate"}function le(e,t,i){return i===void 0&&(e.tag.indexOf("-")>-1||e.attrs!=null&&e.attrs.is||t!=="href"&&t!=="list"&&t!=="form"&&t!=="width"&&t!=="height")&&t in e.dom}var lr=/[A-Z]/g;function fr(e){return"-"+e.toLowerCase()}function St(e){return e[0]==="-"&&e[1]==="-"?e:e==="cssFloat"?"float":e.replace(lr,fr)}function fe(e,t,i){if(t!==i)if(i==null)e.style.cssText="";else if(typeof i!="object")e.style.cssText=i;else if(t==null||typeof t!="object"){e.style.cssText="";for(var o in i){var c=i[o];c!=null&&e.style.setProperty(St(o),String(c))}}else{for(var o in i){var c=i[o];c!=null&&(c=String(c))!==String(t[o])&&e.style.setProperty(St(o),c)}for(var o in t)t[o]!=null&&i[o]==null&&e.style.removeProperty(St(o))}}function _t(){this._=a}_t.prototype=Object.create(null),_t.prototype.handleEvent=function(e){var t=this["on"+e.type],i;typeof t=="function"?i=t.call(e.currentTarget,e):typeof t.handleEvent=="function"&&t.handleEvent(e),this._&&e.redraw!==!1&&(0,this._)(),i===!1&&(e.preventDefault(),e.stopPropagation())};function ue(e,t,i){if(e.events!=null){if(e.events[t]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(e.events[t]==null&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i):(e.events[t]!=null&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(e.events=new _t,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i)}function Ft(e,t,i){typeof e.oninit=="function"&&p.call(e.oninit,t),typeof e.oncreate=="function"&&i.push(p.bind(e.oncreate,t))}function Ht(e,t,i){typeof e.onupdate=="function"&&i.push(p.bind(e.onupdate,t))}function ur(e,t){do{if(e.attrs!=null&&typeof e.attrs.onbeforeupdate=="function"){var i=p.call(e.attrs.onbeforeupdate,e,t);if(i!==void 0&&!i)break}if(typeof e.tag!="string"&&typeof e.state.onbeforeupdate=="function"){var i=p.call(e.state.onbeforeupdate,e,t);if(i!==void 0&&!i)break}return!1}while(!1);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}return function(e,t,i){if(!e)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var o=[],c=u(),m=e.namespaceURI;e.vnodes==null&&(e.textContent=""),t=ht.normalizeChildren(Array.isArray(t)?t:[t]);var C=a;try{a=typeof i=="function"?i:void 0,T(e,e.vnodes,t,o,null,m==="http://www.w3.org/1999/xhtml"?void 0:m)}finally{a=C}e.vnodes=t,c!=null&&u()!==c&&typeof c.focus=="function"&&c.focus();for(var A=0;A<o.length;A++)o[A]()}}});var ee=O((ai,Le)=>{"use strict";Le.exports=Oe()(window)});var ze=O((si,Ve)=>{"use strict";var De=it();Ve.exports=function(n,r,a){var s=[],h=!1,l=!1;function p(){if(h)throw new Error("Nested m.redraw.sync() call");h=!0;for(var d=0;d<s.length;d+=2)try{n(s[d],De(s[d+1]),u)}catch(w){a.error(w)}h=!1}function u(){l||(l=!0,r(function(){l=!1,p()}))}u.sync=p;function f(d,w){if(w!=null&&w.view==null&&typeof w!="function")throw new TypeError("m.mount(element, component) expects a component, not a vnode");var b=s.indexOf(d);b>=0&&(s.splice(b,2),n(d,[],u)),w!=null&&(s.push(d,w),n(d,De(w),u))}return{mount:f,redraw:u}}});var At=O((oi,Ne)=>{"use strict";var Lr=ee();Ne.exports=ze()(Lr,requestAnimationFrame,console)});var re=O((ci,$e)=>{"use strict";$e.exports=function(n){if(Object.prototype.toString.call(n)!=="[object Object]")return"";var r=[];for(var a in n)s(a,n[a]);return r.join("&");function s(h,l){if(Array.isArray(l))for(var p=0;p<l.length;p++)s(h+"["+p+"]",l[p]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var p in l)s(h+"["+p+"]",l[p]);else r.push(encodeURIComponent(h)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}}});var ie=O((li,ke)=>{"use strict";ke.exports=Object.assign||function(n,r){r&&Object.keys(r).forEach(function(a){n[a]=r[a]})}});var Tt=O((fi,Ie)=>{"use strict";var Dr=re(),Vr=ie();Ie.exports=function(n,r){if(/:([^\/\.-]+)(\.{3})?:/.test(n))throw new SyntaxError("Template parameter names *must* be separated");if(r==null)return n;var a=n.indexOf("?"),s=n.indexOf("#"),h=s<0?n.length:s,l=a<0?h:a,p=n.slice(0,l),u={};Vr(u,r);var f=p.replace(/:([^\/\.-]+)(\.{3})?/g,function(y,E,T){return delete u[E],r[E]==null?y:T?r[E]:encodeURIComponent(String(r[E]))}),d=f.indexOf("?"),w=f.indexOf("#"),b=w<0?f.length:w,v=d<0?b:d,g=f.slice(0,v);a>=0&&(g+=n.slice(a,h)),d>=0&&(g+=(a<0?"?":"&")+f.slice(d,b));var x=Dr(u);return x&&(g+=(a<0&&d<0?"?":"&")+x),s>=0&&(g+=n.slice(s)),w>=0&&(g+=(s<0?"":"&")+f.slice(w)),g}});var Se=O((ui,je)=>{"use strict";var zr=Tt();je.exports=function(n,r,a){var s=0;function h(u){return new r(u)}h.prototype=r.prototype,h.__proto__=r;function l(u){return function(f,d){typeof f!="string"?(d=f,f=f.url):d==null&&(d={});var w=new r(function(x,y){u(zr(f,d.params),d,function(E){if(typeof d.type=="function")if(Array.isArray(E))for(var T=0;T<E.length;T++)E[T]=new d.type(E[T]);else E=new d.type(E);x(E)},y)});if(d.background===!0)return w;var b=0;function v(){--b==0&&typeof a=="function"&&a()}return g(w);function g(x){var y=x.then;return x.constructor=h,x.then=function(){b++;var E=y.apply(x,arguments);return E.then(v,function(T){if(v(),b===0)throw T}),g(E)},x}}}function p(u,f){for(var d in u.headers)if({}.hasOwnProperty.call(u.headers,d)&&f.test(d))return!0;return!1}return{request:l(function(u,f,d,w){var b=f.method!=null?f.method.toUpperCase():"GET",v=f.body,g=(f.serialize==null||f.serialize===JSON.serialize)&&!(v instanceof n.FormData),x=f.responseType||(typeof f.extract=="function"?"":"json"),y=new n.XMLHttpRequest,E=!1,T=y,D,tt=y.abort;y.abort=function(){E=!0,tt.call(this)},y.open(b,u,f.async!==!1,typeof f.user=="string"?f.user:void 0,typeof f.password=="string"?f.password:void 0),g&&v!=null&&!p(f,/^content-type$/i)&&y.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof f.deserialize!="function"&&!p(f,/^accept$/i)&&y.setRequestHeader("Accept","application/json, text/*"),f.withCredentials&&(y.withCredentials=f.withCredentials),f.timeout&&(y.timeout=f.timeout),y.responseType=x;for(var et in f.headers)({}).hasOwnProperty.call(f.headers,et)&&y.setRequestHeader(et,f.headers[et]);y.onreadystatechange=function(N){if(!E&&N.target.readyState===4)try{var R=N.target.status>=200&&N.target.status<300||N.target.status===304||/^file:\/\//i.test(u),I=N.target.response,Y;if(x==="json"?!N.target.responseType&&typeof f.extract!="function"&&(I=JSON.parse(N.target.responseText)):(!x||x==="text")&&I==null&&(I=N.target.responseText),typeof f.extract=="function"?(I=f.extract(N.target,f),R=!0):typeof f.deserialize=="function"&&(I=f.deserialize(I)),R)d(I);else{try{Y=N.target.responseText}catch(at){Y=I}var B=new Error(Y);B.code=N.target.status,B.response=I,w(B)}}catch(at){w(at)}},typeof f.config=="function"&&(y=f.config(y,f,u)||y,y!==T&&(D=y.abort,y.abort=function(){E=!0,D.call(this)})),v==null?y.send():typeof f.serialize=="function"?y.send(f.serialize(v)):v instanceof n.FormData?y.send(v):y.send(JSON.stringify(v))}),jsonp:l(function(u,f,d,w){var b=f.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+s++,v=n.document.createElement("script");n[b]=function(g){delete n[b],v.parentNode.removeChild(v),d(g)},v.onerror=function(){delete n[b],v.parentNode.removeChild(v),w(new Error("JSONP request failed"))},v.src=u+(u.indexOf("?")<0?"?":"&")+encodeURIComponent(f.callbackKey||"callback")+"="+encodeURIComponent(b),n.document.documentElement.appendChild(v)})}}});var Fe=O((pi,_e)=>{"use strict";var Nr=te(),$r=At();_e.exports=Se()(window,Nr,$r.redraw)});var ne=O((hi,He)=>{"use strict";He.exports=function(n){if(n===""||n==null)return{};n.charAt(0)==="?"&&(n=n.slice(1));for(var r=n.split("&"),a={},s={},h=0;h<r.length;h++){var l=r[h].split("="),p=decodeURIComponent(l[0]),u=l.length===2?decodeURIComponent(l[1]):"";u==="true"?u=!0:u==="false"&&(u=!1);var f=p.split(/\]\[?|\[/),d=s;p.indexOf("[")>-1&&f.pop();for(var w=0;w<f.length;w++){var b=f[w],v=f[w+1],g=v==""||!isNaN(parseInt(v,10));if(b===""){var p=f.slice(0,w).join();a[p]==null&&(a[p]=Array.isArray(d)?d.length:0),b=a[p]++}else if(b==="__proto__")break;if(w===f.length-1)d[b]=u;else{var x=Object.getOwnPropertyDescriptor(d,b);x!=null&&(x=x.value),x==null&&(d[b]=x=g?[]:{}),d=x}}}return s}});var Pt=O((mi,Be)=>{"use strict";var kr=ne();Be.exports=function(n){var r=n.indexOf("?"),a=n.indexOf("#"),s=a<0?n.length:a,h=r<0?s:r,l=n.slice(0,h).replace(/\/{2,}/g,"/");return l?(l[0]!=="/"&&(l="/"+l),l.length>1&&l[l.length-1]==="/"&&(l=l.slice(0,-1))):l="/",{path:l,params:r<0?{}:kr(n.slice(r+1,s))}}});var Ge=O((di,Ue)=>{"use strict";var Ir=Pt();Ue.exports=function(n){var r=Ir(n),a=Object.keys(r.params),s=[],h=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,p,u){return p==null?"\\"+l:(s.push({k:p,r:u==="..."}),u==="..."?"(.*)":u==="."?"([^/]+)\\.":"([^/]+)"+(u||""))})+"$");return function(l){for(var p=0;p<a.length;p++)if(r.params[a[p]]!==l.params[a[p]])return!1;if(!s.length)return h.test(l.path);var u=h.exec(l.path);if(u==null)return!1;for(var p=0;p<s.length;p++)l.params[s[p].k]=s[p].r?u[p+1]:decodeURIComponent(u[p+1]);return!0}}});var Qe=O((gi,We)=>{"use strict";var jr=it(),Sr=Yt(),_r=te(),Fr=Tt(),Ke=Pt(),Hr=Ge(),Xe=ie(),ae={};We.exports=function(n,r){var a;function s(b,v,g){if(b=Fr(b,v),a!=null){a();var x=g?g.state:null,y=g?g.title:null;g&&g.replace?n.history.replaceState(x,y,w.prefix+b):n.history.pushState(x,y,w.prefix+b)}else n.location.href=w.prefix+b}var h=ae,l,p,u,f,d=w.SKIP={};function w(b,v,g){if(b==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var x=0,y=Object.keys(g).map(function(R){if(R[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(R))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:R,component:g[R],check:Hr(R)}}),E=typeof setImmediate=="function"?setImmediate:setTimeout,T=_r.resolve(),D=!1,tt;if(a=null,v!=null){var et=Ke(v);if(!y.some(function(R){return R.check(et)}))throw new ReferenceError("Default route doesn't match any known routes")}function N(){D=!1;var R=n.location.hash;w.prefix[0]!=="#"&&(R=n.location.search+R,w.prefix[0]!=="?"&&(R=n.location.pathname+R,R[0]!=="/"&&(R="/"+R)));var I=R.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(w.prefix.length),Y=Ke(I);Xe(Y.params,n.history.state);function B(){if(I===v)throw new Error("Could not resolve default route "+v);s(v,null,{replace:!0})}at(0);function at(X){for(;X<y.length;X++)if(y[X].check(Y)){var G=y[X].component,bt=y[X].route,st=G,ot=f=function(W){if(ot===f){if(W===d)return at(X+1);l=W!=null&&(typeof W.view=="function"||typeof W=="function")?W:"div",p=Y.params,u=I,f=null,h=G.render?G:null,x===2?r.redraw():(x=2,r.redraw.sync())}};G.view||typeof G=="function"?(G={},ot(st)):G.onmatch?T.then(function(){return G.onmatch(Y.params,I,bt)}).then(ot,B):ot("div");return}B()}}return a=function(){D||(D=!0,E(N))},typeof n.history.pushState=="function"?(tt=function(){n.removeEventListener("popstate",a,!1)},n.addEventListener("popstate",a,!1)):w.prefix[0]==="#"&&(a=null,tt=function(){n.removeEventListener("hashchange",N,!1)},n.addEventListener("hashchange",N,!1)),r.mount(b,{onbeforeupdate:function(){return x=x?2:1,!(!x||ae===h)},oncreate:N,onremove:tt,view:function(){if(!(!x||ae===h)){var R=[jr(l,p.key,p)];return h&&(R=h.render(R[0])),R}}})}return w.set=function(b,v,g){f!=null&&(g=g||{},g.replace=!0),f=null,s(b,v,g)},w.get=function(){return u},w.prefix="#!",w.Link={view:function(b){var v=b.attrs.options,g={},x,y;Xe(g,b.attrs),g.selector=g.options=g.key=g.oninit=g.oncreate=g.onbeforeupdate=g.onupdate=g.onbeforeremove=g.onremove=null;var E=Sr(b.attrs.selector||"a",g,b.children);return(E.attrs.disabled=Boolean(E.attrs.disabled))?(E.attrs.href=null,E.attrs["aria-disabled"]="true",E.attrs.onclick=null):(x=E.attrs.onclick,y=E.attrs.href,E.attrs.href=w.prefix+y,E.attrs.onclick=function(T){var D;typeof x=="function"?D=x.call(T.currentTarget,T):x==null||typeof x!="object"||typeof x.handleEvent=="function"&&x.handleEvent(T),D!==!1&&!T.defaultPrevented&&(T.button===0||T.which===0||T.which===1)&&(!T.currentTarget.target||T.currentTarget.target==="_self")&&!T.ctrlKey&&!T.metaKey&&!T.shiftKey&&!T.altKey&&(T.preventDefault(),T.redraw=!1,w.set(y,null,v))}),E}},w.param=function(b){return p&&b!=null?p[b]:p},w}});var Je=O((yi,Ye)=>{"use strict";var Br=At();Ye.exports=Qe()(window,Br)});var Z=O((wi,er)=>{"use strict";var Rt=Pe(),Ze=Fe(),tr=At(),S=function(){return Rt.apply(this,arguments)};S.m=Rt;S.trust=Rt.trust;S.fragment=Rt.fragment;S.mount=tr.mount;S.route=Je();S.render=ee();S.redraw=tr.redraw;S.request=Ze.request;S.jsonp=Ze.jsonp;S.parseQueryString=ne();S.buildQueryString=re();S.parsePathname=Pt();S.buildPathname=Tt();S.vnode=it();S.PromisePolyfill=Zt();er.exports=S});var Q=rt(Z());var U=rt(Z());var wt=rt(Z()),_=class{view(r){return r.attrs.a?(0,wt.default)("a",J({class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`},r.attrs.a),[(0,wt.default)("img",{src:`/p/gifcap/css/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"666666"}`}),r.attrs.label]):(0,wt.default)("button",{class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`,onclick:r.attrs.onclick,title:r.attrs.title||r.attrs.label,disabled:r.attrs.disabled},[(0,wt.default)("img",{src:`/p/gifcap/css/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"666666"}`}),r.attrs.label])}};var se=rt(Z());function Ur(n){let r=Math.floor(n/1e3),a=Math.floor(r/60),s=r%60,h=`${s<10?"0":""}${s}`;return`${a>0?`${a<10?"0":""}${a}`:"00"}:${h}`}var mt=class{view(r){return(0,se.default)("span.tag.is-small",[(0,se.default)("img",{src:"/p/gifcap/css/clock.svg?size=16&color=333333"}),Ur(r.attrs.duration)])}};var qt=rt(Z()),K=class{view(r){return(0,qt.default)("section",{class:"view"},[(0,qt.default)("section",J({class:`content ${r.attrs.contentClass||""}`},r.attrs.contentProps||{}),r.children),(0,qt.default)("section",{class:"actions"},r.attrs.actions)])}};function Gr(n){return n<1024?"1 KB":(n=Math.round(n/1024),n<1024?`${n} KB`:`${Math.floor(n/1024*100)/100} MB`)}var Ot=class{constructor(r){this.app=r.attrs.app,this.gif=r.attrs.gif}view(){let r=[(0,U.default)(_,{label:"Download",icon:"download",a:{href:this.gif.url,download:"recording.gif",target:"_blank"},primary:!0}),(0,U.default)(_,{label:"Edit",icon:"pencil",onclick:()=>this.app.editGif()}),(0,U.default)(_,{label:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,U.default)(K,{actions:r},(0,U.default)(".recording-card",[(0,U.default)("a",{href:this.gif.url,download:"recording.gif",target:"_blank"},[(0,U.default)("img.recording",{src:this.gif.url})]),(0,U.default)("footer",[(0,U.default)(mt,{duration:this.gif.duration}),(0,U.default)("span.tag.is-small",[(0,U.default)("a.recording-detail",{href:this.gif.url,download:"recording.gif",target:"_blank"},[(0,U.default)("img",{src:"/p/gifcap/css/download.svg?size=16&color=333333"}),Gr(this.gif.size)])])])]))]}};var z=rt(Z());function lt(n,r,a=0,s=n.length-1){let h=s-a;if(h===0)return a;if(h===1)return r<n[s].timestamp?a:s;let l=Math.floor((s+a)/2),p=n[l].timestamp;return r===p?l:r<p?lt(n,r,a,l):lt(n,r,l,s)}var oe=()=>null,Lt=class{constructor(r){this.app=r.attrs.app,this.recording=r.attrs.recording,this.duration=this.recording.frames[this.recording.frames.length-1].timestamp+this.app.frameLength,this.viewport={width:0,height:0,top:0,left:0,zoom:1},this.playback={head:0,start:0,offset:0,end:this.duration,disposable:oe},this.trim={start:0,end:this.duration},this.crop={top:0,left:0,width:this.recording.width,height:this.recording.height}}get isPlaying(){return this.playback.disposable!==oe}async oncreate(r){this.canvas=r.dom.getElementsByTagName("canvas")[0],this.playbar=r.dom.querySelector(".playbar"),this.content=r.dom.querySelector(".content");let a=()=>this.updateViewport();window.addEventListener("resize",a),this.viewportDisposable=()=>window.removeEventListener("resize",a),this.updateViewport(),this.zoomToFit(),z.default.redraw(),setTimeout(()=>this.play())}zoomToFit(){let r=Math.max(.1,Math.min(1,this.viewport.width*.95/this.recording.width,this.viewport.height*.95/this.recording.height));this.viewport=ut(J({},this.viewport),{zoom:r})}updateViewport(){this.viewport=ut(J({},this.viewport),{width:Math.floor(this.content.clientWidth),height:Math.floor(this.content.clientHeight)})}onbeforeremove(){this.pause(),this.viewportDisposable()}view(){let r=this.crop.top!==0||this.crop.left!==0||this.crop.width!==this.recording.width||this.crop.height!==this.recording.height,a=[(0,z.default)(_,{title:this.isPlaying?"Pause":"Play",iconset:"material",icon:this.isPlaying?"pause":"play",primary:!0,onclick:()=>this.togglePlayPause()}),(0,z.default)(".playbar",[(0,z.default)("input",{type:"range",min:0,max:`${this.duration}`,value:`${this.playback.head}`,disabled:this.isPlaying,oninput:f=>this.onPlaybarInput(f)}),(0,z.default)(".trim-bar",{style:{left:`${this.trim.start*100/this.duration}%`,width:`${(this.trim.end-this.trim.start)*100/this.duration}%`}},[(0,z.default)(".trim-start",{onmousedown:f=>this.onTrimMouseDown("start",f)}),(0,z.default)(".trim-end",{onmousedown:f=>this.onTrimMouseDown("end",f)})])]),(0,z.default)(_,{label:"\u751F\u6210",icon:"gear",onclick:()=>this.startRendering(),primary:!0}),(0,z.default)(_,{title:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})],s=f=>f*this.viewport.zoom,h=s(this.recording.width),l=s(this.recording.height),p=Math.floor(s(this.viewport.top)+this.viewport.height/2-l/2),u=Math.floor(s(this.viewport.left)+this.viewport.width/2-h/2);return[(0,z.default)(K,{actions:a,contentClass:"crop",contentProps:{onwheel:f=>this.onContentWheel(f),onmousedown:f=>this.onContentMouseDown(f),oncontextmenu:f=>f.preventDefault()}},[(0,z.default)(".preview",{style:{top:`${p}px`,left:`${u}px`,width:`${h}px`,height:`${l}px`}},[(0,z.default)("canvas",{width:this.recording.width,height:this.recording.height}),r&&(0,z.default)(".crop-box",{style:{clipPath:`polygon(evenodd, 0 0, 0 ${s(this.recording.height)}px, ${s(this.recording.width)}% ${s(this.recording.height)}px, ${s(this.recording.width)}% 0, 0 0, ${s(this.crop.left)}px ${s(this.crop.top)}px, ${s(this.crop.left)}px ${s(this.crop.top+this.crop.height)}px, ${s(this.crop.left+this.crop.width)}px ${s(this.crop.top+this.crop.height)}px, ${s(this.crop.left+this.crop.width)}px ${s(this.crop.top)}px, ${s(this.crop.left)}px ${s(this.crop.top)}px)`}})])])]}onTrimMouseDown(r,a){a.preventDefault();let s=this.canvas.getContext("2d"),h={width:this.playbar.clientWidth,screenX:a.screenX,head:r==="start"?this.trim.start:this.trim.end,min:r==="start"?0:this.trim.start+this.app.frameLength,max:r==="start"?this.trim.end-this.app.frameLength:this.duration},l=u=>{let f=u.screenX-h.screenX,d=h.head+Math.round(f*this.duration/h.width);this.trim=ut(J({},this.trim),{[r]:Math.max(h.min,Math.min(h.max,d))}),z.default.redraw()},p=()=>{if(document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",p),this.playback.start=this.trim.start,this.playback.end=this.trim.end,this.isPlaying){this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let u=lt(this.recording.frames,this.playback.head);s.putImageData(this.recording.frames[u].imageData,0,0)}z.default.redraw()};document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",p)}onContentWheel(r){r.preventDefault();let a=Math.max(.1,Math.min(2,this.viewport.zoom-r.deltaY/180*.1));this.viewport=ut(J({},this.viewport),{zoom:a})}onContentMouseDown(r){r.button===0&&!r.ctrlKey&&!r.metaKey&&!r.shiftKey?this.onCrop(r):this.onViewportMove(r)}onCrop(r){let a=this.recording.width*this.viewport.zoom,s=this.recording.height*this.viewport.zoom,h=Math.floor(this.viewport.top*this.viewport.zoom+this.viewport.height/2-s/2),l=Math.floor(this.viewport.left*this.viewport.zoom+this.viewport.width/2-a/2),p=r.currentTarget.offsetTop,u=r.currentTarget.offsetLeft,f=y=>Math.max(0,Math.min(this.recording.height,(y.clientY-p-h)/this.viewport.zoom)),d=y=>Math.max(0,Math.min(this.recording.width,(y.clientX-u-l)/this.viewport.zoom)),w=y=>({top:Math.round(f(y)),left:Math.round(d(y))}),b=w(r),v=!1,g=y=>{let E=w(y),T=Math.max(0,Math.min(b.top,E.top)),D=Math.max(0,Math.min(b.left,E.left)),tt=Math.min(this.recording.width-D,Math.abs(b.left-E.left)),et=Math.min(this.recording.height-T,Math.abs(b.top-E.top));this.crop={top:T,left:D,width:tt,height:et},v=!0,z.default.redraw()},x=y=>{y.preventDefault(),document.body.removeEventListener("mousemove",g),document.body.removeEventListener("mouseup",x),(!v||this.crop.width<10||this.crop.height<10)&&(this.crop={top:0,left:0,width:this.recording.width,height:this.recording.height}),z.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",g),document.body.addEventListener("mouseup",x)}onViewportMove(r){let a={top:this.viewport.top,left:this.viewport.left,screenX:r.screenX,screenY:r.screenY},s=l=>{this.viewport=ut(J({},this.viewport),{top:a.top+(l.screenY-a.screenY)/this.viewport.zoom,left:a.left+(l.screenX-a.screenX)/this.viewport.zoom}),z.default.redraw()},h=l=>{l.preventDefault(),document.body.removeEventListener("mousemove",s),document.body.removeEventListener("mouseup",h),z.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",h)}onPlaybarInput(r){this.playback.head=r.target.valueAsNumber;let a=this.canvas.getContext("2d"),s=lt(this.recording.frames,this.playback.head);a.putImageData(this.recording.frames[s].imageData,0,0)}play(){this.playback.disposable();let r=this.canvas.getContext("2d"),a,s;this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let h=()=>{this.playback.head=this.playback.start+(Date.now()-this.playback.offset)%(this.playback.end-this.playback.start);let l=lt(this.recording.frames,this.playback.head);a!==l&&r.putImageData(this.recording.frames[l].imageData,0,0),a=l,z.default.redraw(),s=requestAnimationFrame(h)};s=requestAnimationFrame(h),this.playback.disposable=()=>cancelAnimationFrame(s)}pause(){this.playback.disposable(),this.playback.disposable=oe}togglePlayPause(){this.isPlaying?this.pause():this.play()}startRendering(){this.app.startRendering({trim:{start:lt(this.recording.frames,this.trim.start),end:lt(this.recording.frames,this.trim.end)},crop:this.crop})}};var nt=rt(Z());var Dt=class{constructor(r){this.startTime=0;this.width=0;this.height=0;this.frames=[];this.app=r.attrs.app,this.captureStream=r.attrs.captureStream}async oncreate(r){let a=r.dom.getElementsByTagName("video")[0],s=r.dom.getElementsByTagName("canvas")[0];a.srcObject=this.captureStream;let h=s.getContext("2d"),l=new Worker("/p/gifcap/dist/ticker.js");l.postMessage(this.app.frameLength),l.onmessage=()=>{if(a.videoWidth===0)return;let d=this.startTime===0;if(d){let b=a.videoWidth,v=a.videoHeight;this.startTime=Date.now(),this.width=b,this.height=v,s.width=b,s.height=v}h.drawImage(a,0,0);let w=h.getImageData(0,0,this.width,this.height);this.frames.push({imageData:w,timestamp:d?0:Date.now()-this.startTime})};let p=setInterval(()=>nt.default.redraw(),this.app.frameLength),u=this.captureStream.getVideoTracks()[0],f=()=>this.stopRecording();u.addEventListener("ended",f),this._onbeforeremove=()=>{l.terminate(),clearInterval(p),u.removeEventListener("ended",f),u.stop()},nt.default.redraw()}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}view(){return[(0,nt.default)(K,[(0,nt.default)("p",[(0,nt.default)(mt,{duration:this.startTime===0?0:Date.now()-this.startTime})]),(0,nt.default)(_,{label:"\u505C\u6B62\u5F55\u5236",icon:"square-fill",onclick:()=>this.stopRecording()}),(0,nt.default)("canvas.hidden",{width:640,height:480}),(0,nt.default)("video.hidden",{autoplay:!0,playsinline:!0})])]}stopRecording(){this.app.stopRecording({width:this.width,height:this.height,frames:this.frames})}};var dt=rt(Z());var Vt=class{constructor(r){this.progress=0;this.app=r.attrs.app,this.recording=r.attrs.recording,this.renderOptions=r.attrs.renderOptions}async oncreate(r){let a=new GifEncoder({width:this.renderOptions.crop.width,height:this.renderOptions.crop.height});a.on("progress",l=>{this.progress=l,dt.default.redraw()}),a.once("finished",l=>{let p=URL.createObjectURL(l),u=this.recording.frames[this.renderOptions.trim.end].timestamp-this.recording.frames[this.renderOptions.trim.start].timestamp+this.app.frameLength;this.app.finishRendering({blob:l,url:p,duration:u,size:l.size})});let s=r.dom.getElementsByTagName("canvas")[0].getContext("2d"),h=l=>{if(l>this.renderOptions.trim.end){this._onbeforeremove=()=>a.abort(),a.render();return}let p=this.recording.frames[l],u=p.imageData;s.putImageData(u,0,0),u=s.getImageData(this.renderOptions.crop.left,this.renderOptions.crop.top,this.renderOptions.crop.width,this.renderOptions.crop.height);let f=l<this.renderOptions.trim.end?this.recording.frames[l+1].timestamp-p.timestamp:this.app.frameLength;a.addFrame(u,f),setTimeout(()=>h(l+1),0)};h(this.renderOptions.trim.start)}view(){let r=[(0,dt.default)(_,{label:"Cancel",icon:"square-fill",onclick:()=>this.app.cancelRendering()})];return[(0,dt.default)(K,{actions:r},[(0,dt.default)("progress",{max:"1",value:this.progress,title:"Rendering..."},`Rendering: ${Math.floor(this.progress*100)}%`),(0,dt.default)("canvas.hidden",{width:this.recording.width,height:this.recording.height})])]}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}};var zt=rt(Z());var rr=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Nt=class{constructor(r){this.app=r.attrs.app}view(){return(0,zt.default)(K,[rr?(0,zt.default)("p","\u6211\u4EEC\u6B63\u5728\u52AA\u529B\uFF0C\u624B\u673A\u6682\u4E0D\u652F\u6301\u5F55\u5C4F"):void 0,rr?void 0:(0,zt.default)(_,{label:"\u5F00\u59CB\u5F55\u5236",icon:"play",onclick:()=>this.app.startRecording(),primary:!0})])}};var Kr=12;function $t(n,r){if(n!==r)throw new Error("Invalid state")}var ir=class{constructor(){this.frameLength=Math.floor(1e3/Kr);this._state={name:"start"};window.onbeforeunload=()=>this.state.name!=="start"?"":null}get state(){return this._state}set state(r){this._state=r,Q.default.redraw()}view(){return(0,Q.default)("section",{id:"app",class:this.state.name==="start"?"home":""},[(0,Q.default)("section",{id:"app-body"},[this.body()])])}body(){switch(this.state.name){case"start":return(0,Q.default)(Nt,{app:this});case"playing":return(0,Q.default)(Ot,{app:this,gif:this.state.gif});case"recording":return(0,Q.default)(Dt,{app:this,captureStream:this.state.captureStream});case"previewing":return(0,Q.default)(Lt,{app:this,recording:this.state.recording});case"rendering":return(0,Q.default)(Vt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions})}}async startRecording(){if(!(this.state.name!=="start"&&!window.confirm("This will discard the current recording, are you sure you want to continue?")))try{let r=await navigator.mediaDevices.getDisplayMedia({video:{width:9999,height:9999}});this.state={name:"recording",captureStream:r},Q.default.redraw.sync()}catch(r){console.error(r);return}}stopRecording(r){this.state={name:"previewing",recording:r}}startRendering(r){$t(this.state.name,"previewing"),this.state={name:"rendering",recording:this.state.recording,renderOptions:r}}finishRendering(r){$t(this.state.name,"rendering"),this.state={name:"playing",gif:r,recording:this.state.recording}}cancelRendering(){$t(this.state.name,"rendering"),this.state={name:"previewing",recording:this.state.recording}}editGif(){$t(this.state.name,"playing"),this.state={name:"previewing",recording:this.state.recording}}discardGif(){this.state={name:"start"}}};function Xr(){Q.default.mount(document.getElementById("app-container"),ir)}Xr();})();
//# sourceMappingURL=main.js.map
